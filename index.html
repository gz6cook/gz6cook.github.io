<!DOCTYPE html>
<html>
<head>
<script src="https://unpkg.com/@isomorphic-git/lightning-fs"></script>
<script src="https://unpkg.com/isomorphic-git"></script>
<script type="module">
    import http from 'https://unpkg.com/isomorphic-git/http/web/index.js'
    window.http = http
</script>

</head>
<body>
    Ver #5<br>

    github_token: <input type="text" id="github_token" name="github_token" />
    <button onclick="pushAll()">Push</button>

    <ul>
        <li>
            <a href='recipes/waffel.txt'>Waffel</a>
        </li>
        <li>
            <a href='recipes/kuglof.txt'>Kugl√≥f</a>
        </li>
        <li>
            <a href='recipes/pizza.txt'>Pizza</a>
        </li>
        <hr>
        <li>
            <a href='recipes/kanadai_palacsinta.txt'>Kanadai palacsinta</a>
        </li>
        <li>
            <a href='recipes/tejberizs.txt'>Tejberizs</a>
        </li>
        <hr>
        <li>
            <a href='recipes/csevap.txt'>Csevap</a>
        </li>
    </ul>
</body>

<script>

    async function pushAll() {
    
        // import http from 'https://unpkg.com/isomorphic-git/http/web/index.js'
        // await import('https://unpkg.com/isomorphic-git/http/web/index.js').then(m => window.http = m)

        window.fs = new LightningFS('fs', {wipe: true})
        window.pfs = window.fs.promises
        window.dir = '/tutorial'
    
    
        console.log(dir);
        await pfs.mkdir(dir);
    
        await git.clone({
            fs,
            http,
            dir,
            corsProxy: 'https://cors.isomorphic-git.org',
            url: 'https://github.com/gz6cook/gz6cook.github.io.git',
            // ref: 'main',
            ref: 'git-notes',
            singleBranch: true,
            depth: 1
        }).then(console.log);
    
        await pfs.readdir(dir).then(console.log);
    
        await pfs.readFile('/tutorial/test.txt', { encoding: 'utf8' }).then(console.log)
    
        await pfs.writeFile(dir + "/test.txt", '' + Date.now())
    
        await pfs.readFile('/tutorial/test.txt', { encoding: 'utf8' }).then(console.log)
    
        await git.add({fs, dir, filepath: 'test.txt'})

        await git.commit({
            fs,
            dir: '/tutorial',
            author: {
                name: 'gz6cook',
            },
            message: 'test update'
        }).then(console.log)
    
        await git.push({
            fs,
            http,
            dir: '/tutorial',
            remote: 'origin',
            ref: 'git-notes',
            onAuth: () => (
                // GitHub: use token as username: 
                { 
                    username: document.getElementById("github_token").value
                }
            ),
        }).then(console.log())
    }
    
    </script>
    
</html>
